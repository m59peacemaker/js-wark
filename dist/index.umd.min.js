!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).vigilant={})}(this,(function(e){"use strict";const t=e=>({run:e}),o=e=>t((t=>e.run(t).run(t))),r=e=>o=>t((t=>e(o.run(t)))),u=e=>t((()=>e())),s=()=>({post_propagation:new Set}),n=e=>{for(const t of e.post_propagation)t()};var c=Object.freeze({__proto__:null,construct:t,apply:e=>o=>t((t=>e.run(t)(o.run(t)))),chain:e=>t=>o(r(e)(t)),from_function:u,join:o,lift2:e=>o=>r=>t((t=>e(o.run(t))(r.run(t)))),lift3:e=>o=>r=>u=>t((t=>e(o.run(t))(r.run(t))(u.run(t)))),map:r,of:e=>t((()=>e)),run:e=>{const t=s(),o=e.run(t);return n(t),o}});const l=Symbol("nothing"),p=(e,t,o)=>{e.settled&&e.value===l||t.pre_compute(e,o),e.value!==l&&t.compute(e)},a=(e,t)=>{for(const o of e.observers.values())o.pre_compute(e,t)},d=e=>{for(const t of e.observers.values())t.compute(e)},m=Symbol("uninitialized");class i{constructor(e){this._value=m,this._dependants=new Set,this._queue=[],e((e=>{if(e instanceof i)if(this.has_dependant(e)){let t=m;const o=new Proxy({},{get:(o,r)=>t!==m?t[r]:new i(((t,o)=>e.get(o,(e=>t(e[r])))))});this._set(o),e.get(null,(e=>t=e))}else e.get(null,this._set.bind(this));else this._set(e);return e}),this)}_set(e){for(this._value=e;this._queue.length>0;)this._queue.pop()(e)}get(e,t){this._value===m?(e&&this._dependants.add(e),this._queue.push(t)):t(this._value)}has_dependant(e){if(this._dependants.has(e))return!0;for(const t of this._dependants)if(t.has_dependant(e))return!0;return!1}}const v=(e,t,o)=>{t instanceof i?t.get(e,o):o(t)},_=(e,t)=>v(null,e,t),b=e=>t=>_(t,e),f=e=>new i(e),g=(e,t)=>e instanceof i?f(((o,r)=>e.get(r,(e=>o(t(e)))))):t(e),h=e=>t=>g(t,e),w=(e,t,o)=>{const r=new Map;let u;const s={computed:null,occurred:null,complete:o,observers:r,settled:!0,value:l,observe:e=>{const t=Symbol();return p(s,e,!1),r.set(t,e),()=>r.delete(t)}};return g(t.observe,(o=>{u=o({pre_compute:(e,t)=>{s.computed=e.computed,s.settled=!1,a(s,t)},compute:()=>{const{post_propagation:o}=s.computed;s.settled||(s.settled=!0,t.value!==l&&(s.occurred=s.computed,s.value=e(t.value),o.add((()=>s.value=l))),d(s))}})})),_(o.observe,(e=>{let t;const r=e({pre_compute:e=>{t=e.computed},compute:()=>{o.value!==l&&t.post_propagation.add((()=>{u(),r()}))}})})),s},y=e=>t=>g(t,(t=>g(t.complete,(o=>w(e,t,o))))),z=(e,t)=>{const o=new Map;let r;const u={computed:null,occurred:null,complete:t.complete,observers:o,settled:!0,value:l,observe:e=>{const n=Symbol();return o.set(n,e),1===o.size&&_(t.observe,(e=>r=e(s))),p(u,e,!1),()=>{o.delete(n),0===o.size&&r()}}},s={pre_compute:(e,t)=>{u.computed=e.computed,u.settled=!1,a(u,t)},compute:()=>{const{post_propagation:o}=u.computed;u.settled=!0,t.value!==l&&(u.occurred=u.computed,u.value=e(t.value),o.add((()=>u.value=l))),d(u)}};return u},S=e=>t=>g(t,(t=>z(e,t))),j=Symbol(),M=e=>e,O=()=>{};class k extends Error{constructor(e){super("Event's occurrence depends on its own occurrence."+(e?` ${e}`:""))}}const R=(e,t)=>(e.referenced||e)===(t.referenced||t),x=s(),E=((F={computed:x,occurred:x,observe:()=>O,settled:!0,value:l}).complete=F,F);var F;const T={computed:null,occurred:null,complete:E,observe:()=>O,settled:!0,value:l},q=(e,t,o,r,u)=>{const s=((e,t,o,r,u)=>{const s=new Map;let n,c,m,i,v=!1,b=!1,f=!1,g=!1,h=!1;const w={computed:null,occurred:null,observers:s,settled:!0,value:l,observe:e=>{const l=Symbol();return s.set(l,e),1===s.size&&_(t.observe,(e=>_(r.observe,(t=>_(o.observe,(o=>_(u.observe,(r=>{n=e(y),m=o(y),c=t(S),i=r(S)})))))))),p(w,e,!1),()=>{s.delete(l),0===s.size&&(n(),m(),c(),i())}}},y={pre_compute:(e,o)=>{if(w.computed=e.computed,v){if(o)return void(R(t,e)?b=!0:f=!0);throw new k}w.settled&&(w.settled=!1,v=!0,a(w,o),v=!1)},compute:()=>{const{post_propagation:r}=w.computed;if(!w.settled&&(t.settled||b)&&(o.settled||f)){if(w.settled=!0,t.value!==l||o.value!==l){const u=e(g?T:t,h?T:o);u!==j&&(w.occurred=w.computed,w.value=u,r.add((()=>w.value=l)))}d(w)}}};let z;const S={pre_compute:e=>{z=e.computed},compute:e=>{r.value!==l&&R(r,e)&&z.post_propagation.add((()=>{g=!0,n(),c()})),u.value!==l&&R(u,e)&&z.post_propagation.add((()=>{h=!0,m(),i()}))}};return w})(((t,o)=>e(t.value===l?j:t.value)(o.value===l?j:o.value)),t,o,r,u),n=((e,t)=>{const o=new Map;let r,u,s=!1,n=!1,c=!1;const m={computed:null,occurred:null,observers:o,settled:!0,value:l,observe:s=>{const n=Symbol();return o.set(n,s),1===o.size&&_(e.observe,(e=>_(t.observe,(t=>{r=e(i),u=t(i)})))),p(m,s,!1),()=>{o.delete(n),0===o.size&&(r(),u())}}},i={pre_compute:(t,o)=>{if(m.computed=t.computed,s){if(o)return void(R(e,t)?n=!0:c=!0);throw new k}m.settled&&(m.settled=!1,s=!0,a(m,o),s=!1)},compute:()=>{const{post_propagation:o}=m.computed;if(!m.settled&&(e.settled||n)&&(t.settled||c)){if(m.settled=!0,e.value!==l||t.value!==l){const r=e.occurred&&t.occurred?e.value===l?t.value:e.value:j;r!==j&&(m.occurred=m.computed,m.value=r,o.add((()=>m.value=l)))}d(m)}}};return m})(r,u);return n.complete=n,s.complete=n,s},D=e=>t=>o=>g(t,(t=>g(t.complete,(r=>g(o,(o=>g(o.complete,(u=>q(e,t,o,r,u))))))))),A=new FinalizationRegistry((e=>e())),P=(e,t,o,r)=>{const u=new Map;let s=null,n=t,c=O,p=!1,m=!1;const i={computed:null,occurred:null,observers:u,settled:!0,value:l,observe:e=>{const t=Symbol();return u.set(t,e),1===u.size&&(c=n.observe(b)),i.settled&&i.value===l||e.pre_compute(i,!0),i.value!==l&&e.compute(i),()=>{u.delete(t),u.size===(m?1:0)&&c()}}},v=()=>{const{post_propagation:e}=i.computed,t=s||n;t.settled&&(i.settled=!0,t.value!==l&&(i.occurred=i.computed,i.value=t.value,e.add((()=>i.value=l))),d(i))},b={pre_compute:(e,t)=>{s||(i.computed=e.computed,i.settled&&(i.settled=!1,p=!0,a(i,!0),p=!1))},compute:()=>{i.settled||(o.settled||m)&&v()}},f={pre_compute:(e,t)=>{if(!s){if(i.computed=e.computed,p){if(t)return void(m=!0);throw new k}m=!1,i.settled&&(i.settled=!1,p=!0,a(i,!0),p=!1)}},compute:()=>{const{post_propagation:t}=i.computed;if(null!==s||i.value===l){if(!s)if(o.value!==l)_(o.value,(o=>_(e(n)(o),(e=>{s=e;const r=s.observe(b);c(),t.add((()=>{n=o,c=n.observe(b),r(),s=null})),i.settled||v()}))));else{if(i.settled)return;v()}}else _(o.value,(o=>_(e(n)(o),(e=>{if(e!==n)throw new k("A switching event's occurrence caused its own input event's occurrence, which caused it to switch to an event that is occurring simultaneously.");c(),t.add((()=>{n=o,c=n.observe(b)}))}))))}};return _(o.observe,(e=>_(r.observe,(t=>{const o=e(f);let u;const s=t({pre_compute:e=>{u=e.computed},compute:()=>{r.value!==l&&u.post_propagation.add((()=>{o(),s(),null!==n.complete.occurred&&c()}))}});A.register(i,(()=>{o(),s()}))})))),i},C=(e,t,o,r)=>{const u=P(e,t,o,r);return u.complete=((e,t,o)=>{const r=new Map;let u=e.complete,s=O,n=!1,c=!1;const p=(e,t)=>{m.computed=e.computed,m.settled&&(m.settled=!1,n=!0,a(m,t),n=!1)},m={computed:null,occurred:null,observers:r,settled:!0,value:l,observe:e=>{const o=Symbol();return r.set(o,e),1===r.size&&(s=u.observe(v)),t.settled&&t.value===l||e.pre_compute(m,!1),u.settled&&u.value===l||e.pre_compute(m,!1),m.value!==l&&e.compute(m),()=>{r.delete(o),0===r.size&&s()}}};m.complete=m;const i=()=>{const{post_propagation:e}=m.computed;m.settled=!0,null!==t.complete.occurred&&null!==u.occurred&&(m.occurred=m.computed,m.value=t.complete.value===l?u.value:t.complete.value,e.add((()=>m.value=l))),d(m)},v={pre_compute:p,compute:()=>{t.settled&&(t.complete.settled||c)&&i()}},b={pre_compute:p,compute:()=>{t.value!==l?_(t.value,(e=>{_(e.complete,(e=>{u=e;const o=u.observe(v);s(),s=o,u.settled&&(t.complete.settled||c)&&i()}))})):u.settled&&(t.complete.settled||c)&&i()}},f={pre_compute:(e,t)=>{m.computed=e.computed,n?c=!0:(c=!1,m.settled&&(m.settled=!1,n=!0,a(m,!0),n=!1))},compute:()=>{m.settled||t.settled&&u.settled&&i()}};return _(t.observe,(e=>_(o.observe,(t=>{const o=e(b),r=t(f);A.register(m,(()=>{s(),o(),r()}))})))),m})(t,o,r),u},I=e=>t=>o=>g(t,(t=>g(o,(o=>g(o.complete,(r=>C(e,t,o,r))))))),W=e=>e=>e,$=e=>g(e,(e=>e.updates)),B=e=>t=>o=>g(t,(t=>g(o,(o=>e(t)(o))))),G=h((e=>e.reduce(((e,t)=>B((e=>t=>[...e,t]))(e)(t)),[]))),H=e=>f(((t,o)=>t(e(o)))),J=h((e=>{const t=Object.keys(e);return h((e=>t.reduce(((t,o,r)=>(t[o]=e[r],t)),{})))(G(Object.values(e)))}));var K=Object.freeze({__proto__:null,array:G,_call:_,call:b,create:()=>{let e;const t=f((t=>{e=t}));return t.assign=e,t},construct:f,forward_referencing:H,get:v,object:J,of:e=>f((t=>t(e))),Reference:i,_use:g,use:h,use2:B,use3:e=>t=>o=>r=>g(t,(t=>g(o,(o=>g(r,(r=>e(t)(o)(r)))))))});const L=Symbol(),N=e=>{let t=L;if(b((e=>t=e))(e),t===L)throw new Error("Dynamic.get() was called on a reference before it was assigned a value.");return t.run(Symbol())},Q=new FinalizationRegistry((e=>e())),U=(e,t)=>{let o=t.run();const r=D((e=>t=>t===j?e:N(t)))(I(W)(t.updates)(S($)(e.updates)))(e.updates),u={run:()=>o,updates:r},s=r.observe({pre_compute:()=>{},compute:()=>{r.value!==l&&(o=r.value)}});return Q.register(u,s),u},V=e=>g(e,(e=>g(e.run(),(t=>U(e,t))))),X=e=>{let t=Symbol(),o=null;return{run:r=>(r!==t&&(t=r,o=e(r)),o)}},Y=e=>t=>X((o=>e(t.run(o)))),Z=(e,t)=>{const o=Y(e)(t);return o.updates=z(e,t.updates),o},ee=e=>t=>g(t,(t=>Z(e,t))),te=new FinalizationRegistry((e=>e())),oe=(e,t,o)=>{let r=e;const u={run:()=>r,updates:t};return _(t.observe,(e=>{_(o.observe,(s=>{const n=e({pre_compute:()=>{},compute:()=>{if(t.value!==l){const e=t.value;t.computed.post_propagation.add((()=>{r=e}))}}}),c=s({pre_compute:O,compute:()=>{o.value!==l&&(n(),c())}});te.register(u,(()=>{n(),c()}))}))})),u},re=e=>t=>g(t,(t=>g(t.complete,(o=>oe(e,t,o))))),ue=(e,t)=>{const o=s();e.computed=o,e.occurred=o,e.value=t,a(e,!1),d(e),e.value=l,n(o)},se=e=>{const t=new Map,o={computed:null,occurred:null,complete:T,observers:t,settled:!0,value:l,observe:e=>{const r=Symbol();return t.set(r,e),p(o,e),()=>{t.delete(r)}}};return e((e=>ue(o,e))),o},ne=()=>{let e;const t=se((t=>e=t));return t.produce=e,t};var ce=Object.freeze({__proto__:null,calling:e=>t=>g(t,(t=>g(t.updates,(o=>g(o.complete,(r=>((e,t,o,r)=>{const u=w(e,o,r);let s=e(t.run());const n=u.observe({pre_compute:()=>{},compute:()=>{u.value!==l&&(s=u.value)}}),c=r.observe({pre_compute:()=>{},compute:e=>{e.value!==l&&e.propagation.post_propagation.add((()=>{n(),c()}))}});return{value:s,updates:u}})(e,t,o,r))))))),chain:e=>t=>V(ee(e)(t)),create:e=>re(e)(ne()),get:N,_join:U,join:V,_map:Z,map:ee,of:e=>({run:()=>e,updates:T}),switching:e=>I(W)(N(e))($(e)),updates:$});const le=D((e=>t=>e===j?t:e)),pe=(e,t,o)=>{const r=new Map;let u;const s={computed:null,occurred:null,complete:o.complete,observers:r,settled:!0,value:l,observe:e=>{const t=Symbol();return r.set(t,e),1===r.size&&g(o.observe,(e=>{u=e(n)})),p(s,e,!1),()=>{r.delete(t),0===r.size&&u()}}},n={pre_compute:(e,t)=>{s.computed=e.computed,s.settled=!1,a(s,t)},compute:()=>{const{post_propagation:r}=s.computed;s.settled=!0,o.value!==l&&(s.occurred=s.computed,s.value=e(t.run(s.computed))(o.value),r.add((()=>s.value=l))),d(s)}};return s},ae=e=>t=>o=>g(t,(t=>g(o,(o=>pe(e,t,o))))),de=e=>t=>o=>H((r=>re(t)(ae(e)(r)(o)))),me=de((e=>t=>e+1))(0),ie=I(W)(T),ve=new FinalizationRegistry((e=>e())),_e=(e,t)=>{const o={get computed(){return e.computed},get occurred(){return e.occurred},get observers(){return e.observers},get settled(){return e.settled},get value(){return e.value},get observe(){return e.observe},get referenced(){return e}};o.complete=o;const r=e.observe({pre_compute:O,compute:()=>{e.value!==l&&r()}});return ve.register(o,r),{complete:o,get computed(){return t.computed},get occurred(){return t.occurred},get observers(){return t.observers},get settled(){return t.settled},get value(){return t.value},get observe(){return t.observe},get referenced(){return t}}},be=e=>t=>g(e,(e=>g(t,(t=>_e(e,t))))),fe=e=>be(e)(e),ge=new FinalizationRegistry((e=>e())),he=({ms:e,value:t})=>fe((e=>{const t={computed:null,occurred:null,complete:T,observers:new Map,settled:!0,value:l,observe:e=>{const t=o.deref();if(!t)return;const r=Symbol();return t.observers.set(r,e),p(t,e),()=>{const e=o.deref();e&&e.observers.delete(r)}}},o=new WeakRef(t);return ge.register(t,e((e=>{const t=o.deref();if(t)return ue(t,e)}))),t})((o=>{const r=setTimeout((()=>o(t)),e);return r.unref&&r.unref(),()=>clearTimeout(r)}))),we=e=>t=>ie(S((o=>e(o)?t:T))(t)),ye=e=>se((t=>e.then(t).catch(t))),ze=e=>{const t=S((()=>!0))(e.complete);let o=null!==e.complete.occurred;const r={run:()=>o,updates:t};if(!o){const t=e.complete.observe({pre_compute:()=>{},compute:()=>{e.complete.value!==nothing&&e.complete.computed.post_propagation.add((()=>{o=!0}))}});registry.register(r,t)}return r},Se=e=>t=>y((o=>e(o).run(t.computed)))(t),je=Se(M),Me=ae((e=>t=>e)),Oe=new FinalizationRegistry((e=>e())),ke=(e,t,o)=>{const r=new Map;let u=0;const s={computed:null,occurred:null,observers:r,settled:!0,value:l,observe:e=>{const t=Symbol();return r.set(t,e),p(s,e,!1),()=>r.delete(t)}},n={pre_compute:(e,t)=>{s.settled&&(s.computed=e.computed,s.settled=!1,a(s,t))},compute:()=>{if(s.settled)return;const{post_propagation:r}=s.computed;t.settled&&o.settled&&(s.settled=!0,t.value!==l&&++u,u!==e&&o.value===l||(s.occurred=s.computed,s.value=t.value!==l?t.value:o.value,r.add((()=>{s.value=l,c(),m()}))),d(s))}};let c,m;return s.complete=s,_(t.observe,(e=>_(o.observe,(t=>{c=e(n),m=t(n),Oe.register(s,(()=>{c(),m()}))})))),_e(s,t)};var Re=Object.freeze({__proto__:null,alt:le,complete:e=>g(e,(e=>e.complete)),completed:E,_calling:w,calling:y,count:me,delay:({ms:e})=>{return t=S((t=>he({ms:e,value:t}))),o=ie,e=>o(t(e));var t,o},exposed_producer:ne,Error_Cycle_Detected:k,filter:we,from_promise:ye,_hold:oe,hold:re,_is_complete:ze,is_complete:e=>g(e,ze),_map:z,map:S,merge_array:e=>{const t=e.map((()=>j));return e.slice(1).reduce(((e,o,r)=>D((e=>o=>(e=>t=>o=>{const r=[];for(let u=0;u<o.length;++u)r[u]=u===e?t:o[u];return r})(r+1)(o)(e===j?t:e)))(e)(o)),S((e=>[e,...t.slice(1)]))(e[0]))},_merge_2_with:q,merge_2_with:D,never:T,nothing:j,once:fe,on_demand_producer:e=>{const t=new Map;let o;const r={computed:null,occurred:null,complete:T,observers:t,settled:!0,value:l,observe:s=>{const n=Symbol();return t.set(n,s),1===t.size&&(o=e(u)),p(r,s),()=>{t.delete(n),0===t.size&&o()}}},u=e=>ue(r,e);return r},performing:Se,performed:je,scan:de,_snapshot:pe,snapshot:ae,create_switch:P,switch_updating:I,switching:ie,tag:Me,_take:ke,take:e=>t=>g(t,(t=>g(t.complete,(o=>ke(e,t,o))))),_take_until:_e,take_until:be,take_until_passes:e=>t=>be(we(e)(t))(t),take_until_true:e=>t=>{return e.run()?T:be((o=e,e=>we(M)(Me(o)(e)))($(e)))(t);var o},wait:he});const xe=X(Date.now),Ee=Y((e=>new Date(e).toISOString()))(xe);var Fe=Object.freeze({__proto__:null,construct:X,of:e=>X((()=>e)),chain:e=>t=>X((o=>e(t.run(o)).run(o))),lift2:e=>t=>o=>X((r=>e(t.run(r))(o.run(r)))),iso8601_timestamp:Ee,unix_timestamp:xe});var Te=Object.freeze({__proto__:null,calling:e=>r(y(e)),fetch:({url:e,abort:o,...r})=>t((()=>once(se((t=>globalThis.fetch(e,{...r}).then(t).catch((e=>"AbortError"!==e.code&&t(e)))))))),from_async_function:e=>r(ye)(u(e)),of:e=>({run:t=>{const o=new Map,r={computed:t,occurred:t,observers:o,settled:!0,value:e,observe:e=>{const t=Symbol();return o.set(t,e),p(r,e),()=>o.delete(t)}};return r.complete=r,r}})});e.Action=c,e.Dynamic=ce,e.Event=Re,e.Reference=K,e.Sample=Fe,e.Task=Te,e.create_instant=s,e.immediately=W,e.subsequently=e=>t=>e,Object.defineProperty(e,"__esModule",{value:!0})}));
