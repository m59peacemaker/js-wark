!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).vigilant={})}(this,(function(e){"use strict";const t=e=>({run:e}),o=e=>t((t=>e.run(t).run(t))),r=e=>o=>t((t=>e(o.run(t)))),u=()=>({post_propagation:new Set}),s=e=>{for(const t of e.post_propagation)t()};var l=Object.freeze({__proto__:null,construct:t,apply:e=>o=>t((t=>e.run(t)(o.run(t)))),chain:e=>t=>o(r(e)(t)),join:o,lift2:e=>o=>r=>t((t=>e(o.run(t))(r.run(t)))),lift3:e=>o=>r=>u=>t((t=>e(o.run(t))(r.run(t))(u.run(t)))),map:r,of:e=>t((()=>e)),run:e=>{const t=u(),o=e.run(t);return s(t),o}});const c=Symbol("nothing"),n=(e,t,o)=>{e.settled&&e.value===c||t.pre_compute(e,o),e.value!==c&&t.compute(e)},p=(e,t)=>{for(const o of e.observers.values())o.pre_compute(e,t)},a=e=>{for(const t of e.observers.values())t.compute(e)},d=Symbol("uninitialized");class m{constructor(e){this._value=d,this._dependants=new Set,this._queue=[],e((e=>{if(e instanceof m)if(this.has_dependant(e)){let t=d;const o=new Proxy({},{get:(o,r)=>t!==d?t[r]:new m(((t,o)=>e.get(o,(e=>t(e[r])))))});this._set(o),e.get(null,(e=>t=e))}else e.get(null,this._set.bind(this));else this._set(e);return e}),this)}_set(e){for(this._value=e;this._queue.length>0;)this._queue.pop()(e)}get(e,t){this._value===d?(e&&this._dependants.add(e),this._queue.push(t)):t(this._value)}has_dependant(e){if(this._dependants.has(e))return!0;for(const t of this._dependants)if(t.has_dependant(e))return!0;return!1}}const i=(e,t,o)=>{t instanceof m?t.get(e,o):o(t)},v=(e,t)=>i(null,e,t),_=e=>t=>v(t,e),b=e=>new m(e),f=(e,t)=>e instanceof m?b(((o,r)=>e.get(r,(e=>o(t(e)))))):t(e),g=e=>t=>f(t,e),h=(e,t,o)=>{const r=new Map;let u;const s={computed:null,occurred:null,complete:o,observers:r,settled:!0,value:c,observe:e=>{const t=Symbol();return n(s,e,!1),r.set(t,e),()=>r.delete(t)}};return f(t.observe,(o=>{u=o({pre_compute:(e,t)=>{s.computed=e.computed,s.settled=!1,p(s,t)},compute:()=>{const{post_propagation:o}=s.computed;s.settled||(s.settled=!0,t.value!==c&&(s.occurred=s.computed,s.value=e(t.value),o.add((()=>s.value=c))),a(s))}})})),v(o.observe,(e=>{let t;const r=e({pre_compute:e=>{t=e.computed},compute:()=>{o.value!==c&&t.post_propagation.add((()=>{u(),r()}))}})})),s},w=e=>t=>f(t,(t=>f(t.complete,(o=>h(e,t,o))))),y=(e,t)=>{const o=new Map;let r;const u={computed:null,occurred:null,complete:t.complete,observers:o,settled:!0,value:c,observe:e=>{const l=Symbol();return o.set(l,e),1===o.size&&v(t.observe,(e=>r=e(s))),n(u,e,!1),()=>{o.delete(l),0===o.size&&r()}}},s={pre_compute:(e,t)=>{u.computed=e.computed,u.settled=!1,p(u,t)},compute:()=>{const{post_propagation:o}=u.computed;u.settled=!0,t.value!==c&&(u.occurred=u.computed,u.value=e(t.value),o.add((()=>u.value=c))),a(u)}};return u},z=e=>t=>f(t,(t=>y(e,t))),S=Symbol(),j=e=>e,M=()=>{};class O extends Error{constructor(e){super("Event's occurrence depends on its own occurrence."+(e?` ${e}`:""))}}const k=(e,t)=>(e.referenced||e)===(t.referenced||t),R=u(),x=((E={computed:R,occurred:R,observe:()=>M,settled:!0,value:c}).complete=E,E);var E;const F={computed:null,occurred:null,complete:x,observe:()=>M,settled:!0,value:c},T=(e,t,o,r,u)=>{const s=((e,t,o,r,u)=>{const s=new Map;let l,d,m,i,_=!1,b=!1,f=!1,g=!1,h=!1;const w={computed:null,occurred:null,observers:s,settled:!0,value:c,observe:e=>{const c=Symbol();return s.set(c,e),1===s.size&&v(t.observe,(e=>v(r.observe,(t=>v(o.observe,(o=>v(u.observe,(r=>{l=e(y),m=o(y),d=t(j),i=r(j)})))))))),n(w,e,!1),()=>{s.delete(c),0===s.size&&(l(),m(),d(),i())}}},y={pre_compute:(e,o)=>{if(w.computed=e.computed,_){if(o)return void(k(t,e)?b=!0:f=!0);throw new O}w.settled&&(w.settled=!1,_=!0,p(w,o),_=!1)},compute:()=>{const{post_propagation:r}=w.computed;if(!w.settled&&(t.settled||b)&&(o.settled||f)){if(w.settled=!0,t.value!==c||o.value!==c){const u=e(g?F:t,h?F:o);u!==S&&(w.occurred=w.computed,w.value=u,r.add((()=>w.value=c)))}a(w)}}};let z;const j={pre_compute:e=>{z=e.computed},compute:e=>{r.value!==c&&k(r,e)&&z.post_propagation.add((()=>{g=!0,l(),d()})),u.value!==c&&k(u,e)&&z.post_propagation.add((()=>{h=!0,m(),i()}))}};return w})(((t,o)=>e(t.value===c?S:t.value)(o.value===c?S:o.value)),t,o,r,u),l=((e,t)=>{const o=new Map;let r,u,s=!1,l=!1,d=!1;const m={computed:null,occurred:null,observers:o,settled:!0,value:c,observe:s=>{const l=Symbol();return o.set(l,s),1===o.size&&v(e.observe,(e=>v(t.observe,(t=>{r=e(i),u=t(i)})))),n(m,s,!1),()=>{o.delete(l),0===o.size&&(r(),u())}}},i={pre_compute:(t,o)=>{if(m.computed=t.computed,s){if(o)return void(k(e,t)?l=!0:d=!0);throw new O}m.settled&&(m.settled=!1,s=!0,p(m,o),s=!1)},compute:()=>{const{post_propagation:o}=m.computed;if(!m.settled&&(e.settled||l)&&(t.settled||d)){if(m.settled=!0,e.value!==c||t.value!==c){const r=e.occurred&&t.occurred?e.value===c?t.value:e.value:S;r!==S&&(m.occurred=m.computed,m.value=r,o.add((()=>m.value=c)))}a(m)}}};return m})(r,u);return l.complete=l,s.complete=l,s},q=e=>t=>o=>f(t,(t=>f(t.complete,(r=>f(o,(o=>f(o.complete,(u=>T(e,t,o,r,u))))))))),D=new FinalizationRegistry((e=>e())),A=(e,t,o,r)=>{const u=new Map;let s=null,l=t,n=M,d=!1,m=!1;const i={computed:null,occurred:null,observers:u,settled:!0,value:c,observe:e=>{const t=Symbol();return u.set(t,e),1===u.size&&(n=l.observe(b)),i.settled&&i.value===c||e.pre_compute(i,!0),i.value!==c&&e.compute(i),()=>{u.delete(t),u.size===(m?1:0)&&n()}}},_=()=>{const{post_propagation:e}=i.computed,t=s||l;t.settled&&(i.settled=!0,t.value!==c&&(i.occurred=i.computed,i.value=t.value,e.add((()=>i.value=c))),a(i))},b={pre_compute:(e,t)=>{s||(i.computed=e.computed,i.settled&&(i.settled=!1,d=!0,p(i,!0),d=!1))},compute:()=>{i.settled||(o.settled||m)&&_()}},f={pre_compute:(e,t)=>{if(!s){if(i.computed=e.computed,d){if(t)return void(m=!0);throw new O}m=!1,i.settled&&(i.settled=!1,d=!0,p(i,!0),d=!1)}},compute:()=>{const{post_propagation:t}=i.computed;if(null!==s||i.value===c){if(!s)if(o.value!==c)v(o.value,(o=>v(e(l)(o),(e=>{s=e;const r=s.observe(b);n(),t.add((()=>{l=o,n=l.observe(b),r(),s=null})),i.settled||_()}))));else{if(i.settled)return;_()}}else v(o.value,(o=>v(e(l)(o),(e=>{if(e!==l)throw new O("A switching event's occurrence caused its own input event's occurrence, which caused it to switch to an event that is occurring simultaneously.");n(),t.add((()=>{l=o,n=l.observe(b)}))}))))}};return v(o.observe,(e=>v(r.observe,(t=>{const o=e(f);let u;const s=t({pre_compute:e=>{u=e.computed},compute:()=>{r.value!==c&&u.post_propagation.add((()=>{o(),s(),null!==l.complete.occurred&&n()}))}});D.register(i,(()=>{o(),s()}))})))),i},P=(e,t,o,r)=>{const u=A(e,t,o,r);return u.complete=((e,t,o)=>{const r=new Map;let u=e.complete,s=M,l=!1,n=!1;const d=(e,t)=>{m.computed=e.computed,m.settled&&(m.settled=!1,l=!0,p(m,t),l=!1)},m={computed:null,occurred:null,observers:r,settled:!0,value:c,observe:e=>{const o=Symbol();return r.set(o,e),1===r.size&&(s=u.observe(_)),t.settled&&t.value===c||e.pre_compute(m,!1),u.settled&&u.value===c||e.pre_compute(m,!1),m.value!==c&&e.compute(m),()=>{r.delete(o),0===r.size&&s()}}};m.complete=m;const i=()=>{const{post_propagation:e}=m.computed;m.settled=!0,null!==t.complete.occurred&&null!==u.occurred&&(m.occurred=m.computed,m.value=t.complete.value===c?u.value:t.complete.value,e.add((()=>m.value=c))),a(m)},_={pre_compute:d,compute:()=>{t.settled&&(t.complete.settled||n)&&i()}},b={pre_compute:d,compute:()=>{t.value!==c?v(t.value,(e=>{v(e.complete,(e=>{u=e;const o=u.observe(_);s(),s=o,u.settled&&(t.complete.settled||n)&&i()}))})):u.settled&&(t.complete.settled||n)&&i()}},f={pre_compute:(e,t)=>{m.computed=e.computed,l?n=!0:(n=!1,m.settled&&(m.settled=!1,l=!0,p(m,!0),l=!1))},compute:()=>{m.settled||t.settled&&u.settled&&i()}};return v(t.observe,(e=>v(o.observe,(t=>{const o=e(b),r=t(f);D.register(m,(()=>{s(),o(),r()}))})))),m})(t,o,r),u},C=e=>t=>o=>f(t,(t=>f(o,(o=>f(o.complete,(r=>P(e,t,o,r))))))),I=e=>e=>e,W=e=>f(e,(e=>e.updates)),$=e=>t=>o=>f(t,(t=>f(o,(o=>e(t)(o))))),B=g((e=>e.reduce(((e,t)=>$((e=>t=>[...e,t]))(e)(t)),[]))),G=e=>b(((t,o)=>t(e(o)))),H=g((e=>{const t=Object.keys(e);return g((e=>t.reduce(((t,o,r)=>(t[o]=e[r],t)),{})))(B(Object.values(e)))}));var J=Object.freeze({__proto__:null,array:B,_call:v,call:_,create:()=>{let e;const t=b((t=>{e=t}));return t.assign=e,t},construct:b,forward_referencing:G,get:i,object:H,of:e=>b((t=>t(e))),Reference:m,_use:f,use:g,use2:$,use3:e=>t=>o=>r=>f(t,(t=>f(o,(o=>f(r,(r=>e(t)(o)(r)))))))});const K=Symbol(),L=e=>{let t=K;if(_((e=>t=e))(e),t===K)throw new Error("Dynamic.get() was called on a reference before it was assigned a value.");return t.run(Symbol())},N=new FinalizationRegistry((e=>e())),Q=(e,t)=>{let o=t.run();const r=q((e=>t=>t===S?e:L(t)))(C(I)(t.updates)(z(W)(e.updates)))(e.updates),u={run:()=>o,updates:r},s=r.observe({pre_compute:()=>{},compute:()=>{r.value!==c&&(o=r.value)}});return N.register(u,s),u},U=e=>f(e,(e=>f(e.run(),(t=>Q(e,t))))),V=e=>{let t=Symbol(),o=null;return{run:r=>(r!==t&&(t=r,o=e(r)),o)}},X=e=>t=>V((o=>e(t.run(o)))),Y=(e,t)=>{const o=X(e)(t);return o.updates=y(e,t.updates),o},Z=e=>t=>f(t,(t=>Y(e,t))),ee=new FinalizationRegistry((e=>e())),te=(e,t,o)=>{let r=e;const u={run:()=>r,updates:t};return v(t.observe,(e=>{v(o.observe,(s=>{const l=e({pre_compute:()=>{},compute:()=>{if(t.value!==c){const e=t.value;t.computed.post_propagation.add((()=>{r=e}))}}}),n=s({pre_compute:M,compute:()=>{o.value!==c&&(l(),n())}});ee.register(u,(()=>{l(),n()}))}))})),u},oe=e=>t=>f(t,(t=>f(t.complete,(o=>te(e,t,o))))),re=(e,t)=>{const o=u();e.computed=o,e.occurred=o,e.value=t,p(e,!1),a(e),e.value=c,s(o)},ue=e=>{const t=new Map,o={computed:null,occurred:null,complete:F,observers:t,settled:!0,value:c,observe:e=>{const r=Symbol();return t.set(r,e),n(o,e),()=>{t.delete(r)}}};return e((e=>re(o,e))),o},se=()=>{let e;const t=ue((t=>e=t));return t.produce=e,t};var le=Object.freeze({__proto__:null,calling:e=>t=>f(t,(t=>f(t.updates,(o=>f(o.complete,(r=>((e,t,o,r)=>{const u=h(e,o,r);let s=e(t.run());const l=u.observe({pre_compute:()=>{},compute:()=>{u.value!==c&&(s=u.value)}}),n=r.observe({pre_compute:()=>{},compute:e=>{e.value!==c&&e.propagation.post_propagation.add((()=>{l(),n()}))}});return{value:s,updates:u}})(e,t,o,r))))))),chain:e=>t=>U(Z(e)(t)),create:e=>oe(e)(se()),get:L,_join:Q,join:U,_map:Y,map:Z,of:e=>({run:()=>e,updates:F}),updates:W});const ce=q((e=>t=>e===S?t:e)),ne=(e,t,o)=>{const r=new Map;let u;const s={computed:null,occurred:null,complete:o.complete,observers:r,settled:!0,value:c,observe:e=>{const t=Symbol();return r.set(t,e),1===r.size&&f(o.observe,(e=>{u=e(l)})),n(s,e,!1),()=>{r.delete(t),0===r.size&&u()}}},l={pre_compute:(e,t)=>{s.computed=e.computed,s.settled=!1,p(s,t)},compute:()=>{const{post_propagation:r}=s.computed;s.settled=!0,o.value!==c&&(s.occurred=s.computed,s.value=e(t.run(s.computed))(o.value),r.add((()=>s.value=c))),a(s)}};return s},pe=e=>t=>o=>f(t,(t=>f(o,(o=>ne(e,t,o))))),ae=e=>t=>o=>G((r=>oe(t)(pe(e)(r)(o)))),de=ae((e=>t=>e+1))(0),me=C(I)(F),ie=new FinalizationRegistry((e=>e())),ve=(e,t)=>{const o={get computed(){return e.computed},get occurred(){return e.occurred},get observers(){return e.observers},get settled(){return e.settled},get value(){return e.value},get observe(){return e.observe},get referenced(){return e}};o.complete=o;const r=e.observe({pre_compute:M,compute:()=>{e.value!==c&&r()}});return ie.register(o,r),{complete:o,get computed(){return t.computed},get occurred(){return t.occurred},get observers(){return t.observers},get settled(){return t.settled},get value(){return t.value},get observe(){return t.observe},get referenced(){return t}}},_e=e=>t=>f(e,(e=>f(t,(t=>ve(e,t))))),be=e=>_e(e)(e),fe=new FinalizationRegistry((e=>e())),ge=({ms:e,value:t})=>be((e=>{const t={computed:null,occurred:null,complete:F,observers:new Map,settled:!0,value:c,observe:e=>{const t=o.deref();if(!t)return;const r=Symbol();return t.observers.set(r,e),n(t,e),()=>{const e=o.deref();e&&e.observers.delete(r)}}},o=new WeakRef(t);return fe.register(t,e((e=>{const t=o.deref();if(t)return re(t,e)}))),t})((o=>{const r=setTimeout((()=>o(t)),e);return r.unref&&r.unref(),()=>clearTimeout(r)}))),he=e=>t=>me(z((o=>e(o)?t:F))(t)),we=e=>{const t=z((()=>!0))(e.complete);let o=null!==e.complete.occurred;const r={run:()=>o,updates:t};if(!o){const t=e.complete.observe({pre_compute:()=>{},compute:()=>{e.complete.value!==nothing&&e.complete.computed.post_propagation.add((()=>{o=!0}))}});registry.register(r,t)}return r},ye=e=>t=>w((o=>e(o).run(t.computed)))(t),ze=ye(j),Se=pe((e=>t=>e)),je=new FinalizationRegistry((e=>e())),Me=(e,t,o)=>{const r=new Map;let u=0;const s={computed:null,occurred:null,observers:r,settled:!0,value:c,observe:e=>{const t=Symbol();return r.set(t,e),n(s,e,!1),()=>r.delete(t)}},l={pre_compute:(e,t)=>{s.settled&&(s.computed=e.computed,s.settled=!1,p(s,t))},compute:()=>{if(s.settled)return;const{post_propagation:r}=s.computed;t.settled&&o.settled&&(s.settled=!0,t.value!==c&&++u,u!==e&&o.value===c||(s.occurred=s.computed,s.value=t.value!==c?t.value:o.value,r.add((()=>{s.value=c,d(),m()}))),a(s))}};let d,m;return s.complete=s,v(t.observe,(e=>v(o.observe,(t=>{d=e(l),m=t(l),je.register(s,(()=>{d(),m()}))})))),ve(s,t)};var Oe=Object.freeze({__proto__:null,alt:ce,complete:e=>f(e,(e=>e.complete)),completed:x,_calling:h,calling:w,count:de,delay:({ms:e})=>{return t=z((t=>ge({ms:e,value:t}))),o=me,e=>o(t(e));var t,o},exposed_producer:se,Error_Cycle_Detected:O,filter:he,_hold:te,hold:oe,_is_complete:we,is_complete:e=>f(e,we),_map:y,map:z,merge_array:e=>{const t=e.map((()=>S));return e.slice(1).reduce(((e,o,r)=>q((e=>o=>(e=>t=>o=>{const r=[];for(let u=0;u<o.length;++u)r[u]=u===e?t:o[u];return r})(r+1)(o)(e===S?t:e)))(e)(o)),z((e=>[e,...t.slice(1)]))(e[0]))},_merge_2_with:T,merge_2_with:q,never:F,nothing:S,once:be,on_demand_producer:e=>{const t=new Map;let o;const r={computed:null,occurred:null,complete:F,observers:t,settled:!0,value:c,observe:s=>{const l=Symbol();return t.set(l,s),1===t.size&&(o=e(u)),n(r,s),()=>{t.delete(l),0===t.size&&o()}}},u=e=>re(r,e);return r},performing:ye,performed:ze,scan:ae,_snapshot:ne,snapshot:pe,create_switch:A,switch_updating:C,switching:me,tag:Se,_take:Me,take:e=>t=>f(t,(t=>f(t.complete,(o=>Me(e,t,o))))),_take_until:ve,take_until:_e,take_until_passes:e=>t=>_e(he(e)(t))(t),take_until_true:e=>t=>{return e.run()?F:_e((o=e,e=>he(j)(Se(o)(e)))(W(e)))(t);var o},wait:ge});const ke=V(Date.now),Re=X((e=>new Date(e).toISOString()))(ke);var xe=Object.freeze({__proto__:null,construct:V,of:e=>V((()=>e)),chain:e=>t=>V((o=>e(t.run(o)).run(o))),lift2:e=>t=>o=>V((r=>e(t.run(r))(o.run(r)))),iso8601_timestamp:Re,unix_timestamp:ke});var Ee=Object.freeze({__proto__:null,calling:e=>r(w(e)),fetch:({url:e,abort:o,...r})=>t((()=>once(ue((t=>globalThis.fetch(e,{...r}).then(t).catch((e=>"AbortError"!==e.code&&t(e)))))))),of:e=>({run:t=>{const o=new Map,r={computed:t,occurred:t,observers:o,settled:!0,value:e,observe:e=>{const t=Symbol();return o.set(t,e),n(r,e),()=>o.delete(t)}};return r.complete=r,r}}),map_switching:e=>r((e=>t=>me(z(e)(t)))(e))});e.Action=l,e.Dynamic=le,e.Event=Oe,e.Reference=J,e.Sample=xe,e.Task=Ee,e.create_instant=u,e.immediately=I,e.subsequently=e=>t=>e,Object.defineProperty(e,"__esModule",{value:!0})}));
